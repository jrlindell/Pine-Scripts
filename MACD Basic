//@version=5
strategy(title="MACD color", shorttitle="MACDC")
// Getting inputs
fast_length = input(title="Fast Length", defval=12)
slow_length = input(title="Slow Length", defval=26)
src = input(title="Source", defval=close)
signal_length = input.int(title="Signal Smoothing",  minval = 1, maxval = 50, defval = 9)
sma_source = input.string(title="Oscillator MA Type",  defval="EMA", options=["SMA", "EMA"])
sma_signal = input.string(title="Signal Line MA Type", defval="EMA", options=["SMA", "EMA"])
// Plot colors
col_macd = input(#2962FF, "MACD Line  ", group="Color Settings", inline="MACD")
col_signal = input(#FF6D00, "Signal Line  ", group="Color Settings", inline="Signal")
col_grow_above = input(#26A69A, "Above   Grow", group="Histogram", inline="Above") 
col_fall_above = input(#B2DFDB, "Fall", group="Histogram", inline="Above") // light
col_grow_below = input(#FFCDD2, "Below Grow", group="Histogram", inline="Below") // light
col_fall_below = input(#FF5252, "Fall", group="Histogram", inline="Below")
// Calculating
fast_ma = sma_source == "SMA" ? ta.sma(src, fast_length) : ta.ema(src, fast_length)
slow_ma = sma_source == "SMA" ? ta.sma(src, slow_length) : ta.ema(src, slow_length)
macd = fast_ma - slow_ma
signal = sma_signal == "SMA" ? ta.sma(macd, signal_length) : ta.ema(macd, signal_length)
hist = macd - signal
plot(hist, title="Histogram", style=plot.style_columns, color=(hist>=0 ? (hist[1] < hist ? col_grow_above : col_fall_above) : (hist[1] < hist ? col_grow_below : col_fall_below)))


// STEP 1: Time Range
// Configure backtest start date with inputs
startDay = input.int(title="Start Day",
     defval=1, minval=1, maxval=31)
startMonth = input.int(title="Start Month",
     defval=1, minval=1, maxval=12)
startYear = input.int(title="Start Year",
     defval=2019, minval=2009, maxval=2100)
     
// STEP 2:
// See if this bar's time happened on/after start date
afterStartDate = (time >= timestamp(syminfo.timezone,
     startYear, startMonth, startDay, 0, 0))



longBuy = hist>=0 and hist[1] < hist // dark
longSell = hist >= 0 and hist[1] >= hist
shortBuy = hist < 0 and hist[1] > hist
shortSell = hist < 0 and hist[1] <= hist

longProfitPerc = input.float(title="Long Take Profit (%)", minval=0.0, step=0.1, defval=3) / 100
shortProfitPerc = input.float(title="Short Take Profit (%)", minval=0.0, step=0.1, defval=3) / 100
longExitPrice  = strategy.position_avg_price * (1 + longProfitPerc)
shortExitPrice = strategy.position_avg_price * (1 - shortProfitPerc)
longLossPerc = input.float(title="Long Stop Loss (%)", minval = 0.0, step = 0.1, defval = 1) * 0.01
shortLossPerc = input.float(title="Short Stop Loss (%)", minval = 0.0, step = 0.1, defval = 1) * 0.01
longStopPrice  = strategy.position_avg_price * (1 - longLossPerc)
shortStopPrice = strategy.position_avg_price * (1 + shortLossPerc)



if (afterStartDate)
    strategy.entry("Long", strategy.long, when = longBuy)
    strategy.entry("Short", strategy.short, when = shortBuy)
    strategy.close("Long", when=longSell)
    strategy.close("Short", when=shortSell)
    
// take profit and stop loss    
if (strategy.position_size > 0)
    strategy.exit(id = "Long SL", stop=longStopPrice)
    strategy.exit(id="Long TP", limit=longExitPrice)
if (strategy.position_size < 0)
    strategy.exit(id = "Short SL", stop=shortStopPrice)
    strategy.exit(id="Short TP", limit=shortExitPrice)
